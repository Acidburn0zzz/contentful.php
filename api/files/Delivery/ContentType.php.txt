<?php
/**
 * @copyright 2015 Contentful GmbH
 * @license   MIT
 */

namespace Contentful\Delivery;

class ContentType implements \JsonSerializable
{
    /**
     * Name of the Content Type.
     *
     * @var string
     */
    private $name;

    /**
     * Description of the Content Type.
     *
     * @var string|null
     */
    private $description;

    /**
     * The fields, keyed by ID.
     *
     * @var object
     */
    private $fields = [];

    /**
     * ID of main Field used for display.
     *
     * @var string|null
     */
    private $displayField = null;

    /**
     * @var SystemProperties
     */
    private $sys;

    /**
     * ContentType constructor.
     *
     * @param  string                                  $name
     * @param  string|null                             $description
     * @param  \Contentful\Delivery\ContentTypeField[] $fields
     * @param  string|null                             $displayField
     * @param  SystemProperties                        $sys
     */
    public function __construct($name, $description, array $fields, $displayField = null, SystemProperties $sys)
    {
        $this->name = $name;
        $this->description = $description;
        foreach ($fields as $field) {
            $this->fields[$field->getId()] = $field;
        }
        $this->displayField = $displayField;
        $this->sys = $sys;
    }

    /**
     * @return string
     */
    public function getName()
    {
        return $this->name;
    }

    /**
     * @return \Contentful\Delivery\ContentTypeField[]
     */
    public function getFields()
    {
        return $this->fields;
    }

    /**
     * @return string|null
     */
    public function getDescription()
    {
        return $this->description;
    }

    /**
     * @param  string  $fieldId
     *
     * @return \Contentful\Delivery\ContentTypeField|null
     */
    public function getField($fieldId)
    {
        if (!isset($this->fields[$fieldId])) {
            return null;
        }
        return $this->fields[$fieldId];
    }

    /**
     * @return \Contentful\Delivery\ContentTypeField|null
     */
    public function getDisplayField()
    {
        if (null === $this->displayField) {
            return null;
        }
        return $this->getField($this->displayField);
    }

    /**
     * @return string
     */
    public function getId()
    {
        return $this->sys->getId();
    }

    /**
     * @return int
     */
    public function getRevision()
    {
        return $this->sys->getRevision();
    }

    /**
     * @return \DateTimeImmutable
     */
    public function getUpdatedAt()
    {
        return $this->sys->getUpdatedAt();
    }

    /**
     * @return \DateTimeImmutable
     */
    public function getCreatedAt()
    {
        return $this->sys->getCreatedAt();
    }

    /**
     * @return Space
     */
    public function getSpace()
    {
        return $this->sys->getSpace();
    }

    /**
     * Returns an object to be used by `json_encode` to serialize objects of this class.
     *
     * @return object
     *
     * @see http://php.net/manual/en/jsonserializable.jsonserialize.php JsonSerializable::jsonSerialize
     *
     * @api
     */
    public function jsonSerialize()
    {
        return (object) [
            'name' => $this->name,
            'description' => $this->description,
            'displayField' => $this->displayField,
            'sys' => $this->sys,
            'fields' => $this->fields
        ];
    }
}

